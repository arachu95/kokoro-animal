<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ã“ã“ã‚ã®ã©ã†ã¶ã¤ï½œãƒãƒ¼ãƒ è¨ºæ–­ï¼ˆÎ²ï¼‰</title>
<style>
body{font-family:system-ui,-apple-system,"Segoe UI",sans-serif;margin:24px;line-height:1.6}
.card{max-width:760px;margin:0 auto;padding:18px;border:1px solid #ddd;border-radius:14px}
button{padding:10px 14px;border-radius:10px;border:1px solid #ccc;background:#fff;cursor:pointer;margin:6px 6px 0 0}
button:hover{background:#f6f6f6}
button:disabled{opacity:.45;cursor:not-allowed}
.muted{color:#666;font-size:14px}
.hr{height:1px;background:#eee;margin:16px 0}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}
.pill{display:inline-flex;align-items:center;gap:8px;border:1px solid #eee;border-radius:999px;padding:8px 10px;background:#fafafa}
.count{min-width:2ch;text-align:center;font-weight:700}
.big{font-size:22px;font-weight:800;margin:8px 0}
.kpi{display:grid;grid-template-columns:1fr;gap:10px}
@media (min-width:720px){ .kpi{grid-template-columns:1fr 1fr} }
.box{border:1px solid #eee;border-radius:12px;padding:12px;background:#fff}
</style>
</head>
<body>
<div class="card">
<h1>ã“ã“ã‚ã®ã©ã†ã¶ã¤ï½œãƒãƒ¼ãƒ è¨ºæ–­ ğŸ§©</h1>
<p class="muted">æœ€å¤§5äººã¾ã§ã€‚å‹•ç‰©ã‚’äººæ•°åˆ†ã ã‘æŠ¼ã—ã¦ã€Œè¨ºæ–­ã™ã‚‹ã€ã€‚</p>

<div id="app"></div>

<p class="muted" style="margin-top:16px">
â€»äººã‚’å›ºå®šã™ã‚‹è¨ºæ–­ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<b>ã€Œã“ã®ãƒãƒ¼ãƒ ã®â€œå ´â€ã®å‚¾å‘ã€</b>ã‚’è¦‹ã¾ã™ã€‚
</p>
</div>

<script>
/** ========= è¨­å®š ========= */
const MAX_N = 5;

const ANIMALS = [
{key:"owl", emoji:"ğŸ¦‰", name:"ãƒ•ã‚¯ãƒ­ã‚¦", short:"è¦³æ¸¬"},
{key:"dog", emoji:"ğŸ¶", name:"ã„ã¬", short:"å…±é³´"},
{key:"squirrel", emoji:"ğŸ¿ï¸", name:"ãƒªã‚¹", short:"è¨­è¨ˆ"},
{key:"cat", emoji:"ğŸ±", name:"ã­ã“", short:"æµå‹•"},
{key:"rabbit", emoji:"ğŸ°", name:"ã†ã•ã", short:"èª¿å¾‹"},
];

// é€†ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆå›å¾©ã®ä¸€æ‰‹ï¼‰
const RECOVERY_MAP = {
owl: {key:"cat", text:"ğŸ¦‰ï¼ˆè¦³æ¸¬ï¼‰ãŒå¼·ã„ã¨ãã¯ã€ğŸ±ï¼ˆæµå‹•ï¼‰ã‚’ä¸€æ™‚çš„ã«è¶³ã™ã¨å ´ãŒå‹•ãã‚„ã™ã„"},
squirrel: {key:"rabbit", text:"ğŸ¿ï¸ï¼ˆè¨­è¨ˆï¼‰ãŒå¼·ã„ã¨ãã¯ã€ğŸ°ï¼ˆèª¿å¾‹ï¼‰ã§åœ§ã‚’æŠœãã¨ç‡ƒãˆã«ãã„"},
dog: {key:"owl", text:"ğŸ¶ï¼ˆå…±é³´ï¼‰ãŒå¼·ã„ã¨ãã¯ã€ğŸ¦‰ï¼ˆè¦³æ¸¬ï¼‰ã§è·é›¢ã¨æ•´ç†ã‚’å…¥ã‚Œã‚‹ã¨æ±ºã¾ã‚Šã‚„ã™ã„"},
cat: {key:"squirrel",text:"ğŸ±ï¼ˆæµå‹•ï¼‰ãŒå¼·ã„ã¨ãã¯ã€ğŸ¿ï¸ï¼ˆè¨­è¨ˆï¼‰ã§å½¢ã«è½ã¨ã™ã¨å®šç€ã™ã‚‹"},
rabbit: {key:"dog", text:"ğŸ°ï¼ˆèª¿å¾‹ï¼‰ãŒå¼·ã„ã¨ãã¯ã€ğŸ¶ï¼ˆå…±é³´ï¼‰ã§æ¸©åº¦ã‚’ä¸Šã’ã‚‹ã¨åœæ»ã—ã«ãã„"},
};

// ã€Œç©´ã€è§£èª¬ï¼ˆè¶³ã‚Šãªã„ã¨èµ·ããŒã¡ï¼‰
const HOLE_HINT = {
owl: "ğŸ¦‰ãŒè¶³ã‚Šãªã„ã¨ã€å…¨ä½“åƒãŒæ´ã‚ãšã€ä½•ã‚’å„ªå…ˆã™ã‚‹ï¼Ÿã€ãŒæ›–æ˜§ã«ãªã‚Šã‚„ã™ã„ã€‚",
dog: "ğŸ¶ãŒè¶³ã‚Šãªã„ã¨ã€ç©ºæ°—ãŒç¡¬ããªã‚Šã€è¨€ã„ã«ãã„ã“ã¨ã€ãŒå¢—ãˆã‚„ã™ã„ã€‚",
squirrel: "ğŸ¿ï¸ãŒè¶³ã‚Šãªã„ã¨ã€æ±ºã¾ã£ã¦ã‚‚å½¢ã«ãªã‚‰ãšã€çµå±€é€²ã¾ãªã„ã€ãŒèµ·ãã‚„ã™ã„ã€‚",
cat: "ğŸ±ãŒè¶³ã‚Šãªã„ã¨ã€ç™ºæƒ³ã®åˆ‡ã‚Šæ›¿ãˆãŒèµ·ãã«ããã€æ­£ã—ã„ã‘ã©å‹•ã‹ãªã„ã€ã«ãªã‚Šã‚„ã™ã„ã€‚",
rabbit: "ğŸ°ãŒè¶³ã‚Šãªã„ã¨ã€æ‘©æ“¦ã‚„ç–²åŠ´ãŒæŠœã‘ã«ããã€ãªã‚“ã‹ã—ã‚“ã©ã„ã€ãŒæ®‹ã‚Šã‚„ã™ã„ã€‚",
};

// ã€Œé‡å¿ƒã€è§£èª¬ï¼ˆãƒãƒ¼ãƒ ã®é›°å›²æ°—ï¼‰
const CENTER_HINT = {
owl: "ğŸ¦‰é‡å¿ƒï¼šã‚ˆãè¦³å¯Ÿã—ã€æ·±ãè€ƒãˆã‚‹ãƒãƒ¼ãƒ ã€‚å¼·ã¿ã¯ç†è§£ã¨æ´å¯Ÿã€‚å¼±ã¿ã¯è€ƒãˆã™ãã§åœæ­¢ã—ã‚„ã™ã„ã€‚",
dog: "ğŸ¶é‡å¿ƒï¼šé–¢ä¿‚æ€§ã¨æ¸©åº¦ãŒå¼·ã„ãƒãƒ¼ãƒ ã€‚å¼·ã¿ã¯å®‰å¿ƒã¨å”åŠ›ã€‚å¼±ã¿ã¯æ±ºæ–­ãŒå…ˆé€ã‚Šã«ãªã‚Šã‚„ã™ã„ã€‚",
squirrel: "ğŸ¿ï¸é‡å¿ƒï¼šç¾å®Ÿã«è½ã¨ã—ã¦é€²ã‚ã‚‹ãƒãƒ¼ãƒ ã€‚å¼·ã¿ã¯å®Ÿè¡Œã¨å®‰å®šã€‚å¼±ã¿ã¯è² æ‹…ãŒé›†ä¸­ã—ç‡ƒãˆã‚„ã™ã„ã€‚",
cat: "ğŸ±é‡å¿ƒï¼šå¤‰åŒ–ã¨ã‚¢ã‚¤ãƒ‡ã‚¢ãŒå‡ºã‚‹ãƒãƒ¼ãƒ ã€‚å¼·ã¿ã¯çªç ´åŠ›ã€‚å¼±ã¿ã¯å®šç€ã›ãšæ•£ã‚Šã‚„ã™ã„ã€‚",
rabbit: "ğŸ°é‡å¿ƒï¼šæ‘©æ“¦ã‚’æ¸›ã‚‰ã—æ•´ãˆã‚‹ãƒãƒ¼ãƒ ã€‚å¼·ã¿ã¯å›å¾©ã¨å„ªã—ã•ã€‚å¼±ã¿ã¯ä¸¸ãåã¾ã‚Šåœæ»ã—ã‚„ã™ã„ã€‚",
};

/** ========= çŠ¶æ…‹ ========= */
let counts = {owl:0,dog:0,squirrel:0,cat:0,rabbit:0};

/** ========= UI ========= */
const app = document.getElementById("app");

function totalN(){
return Object.values(counts).reduce((a,b)=>a+b,0);
}

function clampNonNeg(){
for(const a of ANIMALS){
if(counts[a.key] < 0) counts[a.key] = 0;
}
}

function render(){
const n = totalN();
const full = n >= MAX_N;

const rows = ANIMALS.map(a => {
const canAdd = !full;
const canSub = counts[a.key] > 0;
return `
<div class="row">
<div class="pill">
<span style="font-size:18px">${a.emoji}</span>
<b>${a.name}</b>
<span class="muted">(${a.short})</span>
</div>
<button ${canSub ? "" : "disabled"} onclick="sub('${a.key}')">âˆ’</button>
<div class="count">${counts[a.key]}</div>
<button ${canAdd ? "" : "disabled"} onclick="add('${a.key}')">ï¼‹</button>
</div>
`;
}).join("");

app.innerHTML = `
<div class="box">
<div class="muted">äººæ•°å…¥åŠ›ï¼ˆæœ€å¤§ ${MAX_N} äººï¼‰</div>
${rows}
<div class="hr"></div>
<div><b>åˆè¨ˆï¼š</b>${n} / ${MAX_N} äºº</div>
<div style="margin-top:10px">
<button onclick="diagnose()" ${n>0 ? "" : "disabled"}>ğŸ§  è¨ºæ–­ã™ã‚‹</button>
<button onclick="resetAll()">ğŸ” ãƒªã‚»ãƒƒãƒˆ</button>
</div>
<div class="muted" style="margin-top:10px">â€»5äººæœªæº€ã§ã‚‚è¨ºæ–­ã§ãã¾ã™ï¼ˆÎ²ï¼‰ã€‚</div>
</div>

<div id="result"></div>
`;
}

function add(k){
if(totalN() >= MAX_N) return;
counts[k] += 1;
render();
}

function sub(k){
counts[k] -= 1;
clampNonNeg();
render();
}

function resetAll(){
counts = {owl:0,dog:0,squirrel:0,cat:0,rabbit:0};
render();
}

/** ========= è¨ºæ–­ãƒ­ã‚¸ãƒƒã‚¯ ========= */
function argMax(obj){
let bestK=null, bestV=-Infinity;
for(const [k,v] of Object.entries(obj)){
if(v > bestV){ bestV=v; bestK=k; }
}
return bestK;
}
function argMin(obj){
let bestK=null, bestV=Infinity;
for(const [k,v] of Object.entries(obj)){
if(v < bestV){ bestV=v; bestK=k; }
}
return bestK;
}
function normalizeCounts(){
const n = totalN();
if(n === 0) return null;
const R = {};
for(const a of ANIMALS){
R[a.key] = counts[a.key] / n;
}
return R;
}

// Bias = ||R - u|| (u = (0.2,...))
function biasScore(R){
const u = 0.2;
let s = 0;
for(const a of ANIMALS){
const d = (R[a.key] - u);
s += d*d;
}
return Math.sqrt(s);
}
function biasLabel(b){
// ã–ã£ãã‚Šãƒ©ãƒ™ãƒ«ï¼ˆæ•°å€¤ã¯å‡ºã•ãªã„ï¼‰
if(b < 0.12) return {tag:"å®‰å®š", desc:"ã‹ãªã‚Šãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ã„ã€‚ç‡ƒãˆã«ããæŒç¶šã—ã‚„ã™ã„ã€‚"};
if(b < 0.22) return {tag:"ã‚„ã‚„åã‚Š", desc:"å½¹å‰²ã«å¯„ã‚ŠãŒã‚ã‚‹ã€‚ç©´ã‚’å°‘ã—è¶³ã™ã¨æ•´ã„ã‚„ã™ã„ã€‚"};
return {tag:"åã‚Šå¼·ã‚", desc:"ç‰¹å®šã®å½¹å‰²ã«é›†ä¸­ã—ã‚„ã™ã„ã€‚ç‡ƒãˆãƒ»åœæ»ã®äºˆå…†ãŒå‡ºã‚„ã™ã„ã€‚"};
}

function diagnose(){
const result = document.getElementById("result");
const n = totalN();
if(n === 0){
result.innerHTML = "";
return;
}
const R = normalizeCounts();

const center = argMax(R);
const hole = argMin(R);
const crowd = center; // æœ€å¤§æˆåˆ†ï¼éå¯†ï¼ˆç°¡æ˜“ï¼‰
const b = biasScore(R);
const bl = biasLabel(b);

// ä¸€è¨€ã§ã€Œå ´ã€ã‚’è¨€ã†
const centerText = CENTER_HINT[center];

// ç©´ã®èª¬æ˜
const holeText = HOLE_HINT[hole];

// å›å¾©ã®ä¸€æ‰‹ï¼ˆéå¯†â†’é€†ãƒ™ã‚¯ãƒˆãƒ«ï¼‰
const rec = RECOVERY_MAP[crowd];

function detectFormation(counts){
const entries = Object.entries(counts);
const max = Math.max(...entries.map(([k,v]) => v));
const top = entries.filter(([k,v]) => v === max).map(([k]) => k);

if(top.length >= 2){
return { name:"ğŸ§©æ··æˆå‹", desc:"ãƒˆãƒƒãƒ—ãŒåŒç‚¹ã€‚æŒ‡æ®ãŒåˆ†æ•£ã—ã‚„ã™ãã€çŠ¶æ³ã§å½¢ãŒå¤‰ã‚ã‚‹ã‚¿ã‚¤ãƒ—ã€‚" };
}

const leader = top[0];

switch(leader){
case "dog":
return { name:"ğŸ¶ãƒ¯ãƒ³ãƒˆãƒƒãƒ—å‹", desc:"å…±æ„ŸãŒå‰ã«ç«‹ã¤ã€‚å®‰å¿ƒæ„Ÿã¯å¼·ã„ãŒã€åˆ¤æ–­ãŒé…ã‚Œã‚„ã™ã„ã€‚" };
case "owl":
return { name:"ğŸ¦‰å¸ä»¤å¡”å‹", desc:"è¦³æ¸¬ã¨åˆ¤æ–­ãŒé›†ä¸­ã€‚é™ã‹ã ãŒæ±ºæ–­ã¯é‹­ã„ã€‚" };
case "squirrel":
return { name:"ğŸ¿ï¸ä¸­ç›¤åˆ¶åœ§å‹", desc:"è¨­è¨ˆãŒå…¨ä½“ã‚’æ”¯é…ã€‚å®‰å®šã™ã‚‹ãŒè² æ‹…é›†ä¸­ã«æ³¨æ„ã€‚" };
case "cat":
return { name:"ğŸ±æµå‹•çªç ´å‹", desc:"è‡ªç”±ã«å‹•ãã€‚çªç ´åŠ›ã¯ã‚ã‚‹ãŒæ•£ã‚Šã‚„ã™ã„ã€‚" };
case "rabbit":
return { name:"ğŸ°èª¿å¾‹å¾ªç’°å‹", desc:"ç©ºæ°—ã‚’æ•´ãˆç¶šã‘ã‚‹ã€‚å„ªã—ã„ãŒåœæ»ã—ã‚„ã™ã„ã€‚" };
default:
return { name:"ğŸ§©æ··æˆå‹", desc:"å½¹å‰²ãŒåˆ†æ•£ã—ã¦ã„ã‚‹ã€‚çŠ¶æ³ã«å¿œã˜ã¦å½¢ãŒå¤‰ã‚ã‚Šã‚„ã™ã„ã€‚" };
}
}

const formation = detectFormation(counts);
  
// â€œè¶³ã™ãªã‚‰ã“ã‚Œâ€ã®ææ¡ˆï¼ˆç©´ or é€†ãƒ™ã‚¯ãƒˆãƒ«ï¼‰
const addKey = (R[hole] === 0) ? hole : rec.key; // ç©´ãŒã‚¼ãƒ­ãªã‚‰ç©´å„ªå…ˆã€ãã†ã§ãªã‘ã‚Œã°å›å¾©å„ªå…ˆ
const addAnimal = ANIMALS.find(x=>x.key===addKey);

// ã‚·ã‚§ã‚¢æ–‡
const share = `ãƒãƒ¼ãƒ è¨ºæ–­ï¼šé‡å¿ƒã¯${ANIMALS.find(x=>x.key===center).emoji}${ANIMALS.find(x=>x.key===center).name}ã€ç©´ã¯${ANIMALS.find(x=>x.key===hole).emoji}${ANIMALS.find(x=>x.key===hole).name}ã€‚#ã“ã“ã‚ã®ã©ã†ã¶ã¤è¨ºæ–­`;

result.innerHTML = `
<div class="hr"></div>

<div class="big">è¨ºæ–­çµæœï¼ˆãƒãƒ¼ãƒ ã®å ´ï¼‰</div>

<div class="kpi">
<div class="box">
<b>ğŸ§  é‡å¿ƒï¼ˆCenterï¼‰</b>
<div style="margin-top:8px">${centerText}</div>
</div>

<div class="box">
<b>âš ï¸ åã‚Šï¼ˆBiasï¼‰ï¼š${bl.tag}</b>
<div style="margin-top:8px">${bl.desc}</div>
</div>

<div class="box">
<b>ğŸ§­ ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</b>
<div style="margin-top:8px"><b>${formation.name}</b><br>${formation.desc}</div>
</div>

<div class="box">
<b>ğŸ•³ ç©´ï¼ˆHoleï¼‰</b>
<div style="margin-top:8px">${holeText}</div>
</div>

<div class="box">
<b>ğŸ”¥ è² æ‹…ãŒé›†ä¸­ã—ã‚„ã™ã„å ´æ‰€</b>
<div style="margin-top:8px">ä»Šã„ã¡ã°ã‚“å¼·ã„ã®ã¯ <b>${ANIMALS.find(x=>x.key===crowd).emoji}${ANIMALS.find(x=>x.key===crowd).name}</b>ã€‚<br>
ã“ã“ãŒé ‘å¼µã‚Šã™ãã¦ç‡ƒãˆã‚„ã™ã„ï¼ˆã¾ãŸã¯åœæ­¢ã—ã‚„ã™ã„ï¼‰ãƒã‚¤ãƒ³ãƒˆã€‚</div>
</div>
</div>

<div class="hr"></div>

<div class="box">
<b>ğŸŒ¿ å›å¾©ã®ä¸€æ‰‹</b>
<div style="margin-top:8px">${rec.text}</div>
<div style="margin-top:10px">
<b>âœ… ã„ã¾è¶³ã™ãªã‚‰ï¼š</b> ${addAnimal.emoji}${addAnimal.name}
<div class="muted">ï¼ˆä»–ãƒãƒ¼ãƒ ã‹ã‚‰â€œå½¹å‰²ã ã‘â€30åˆ†å€Ÿã‚Šã‚‹ã€é›‘è«‡æ ã‚’å…¥ã‚Œã‚‹ã€å¸ä¼šã‚’å¤‰ãˆã‚‹â€¦ãªã©ã§OKï¼‰</div>
</div>
</div>

<div class="hr"></div>

<button onclick="copyShare()">ğŸ“‹ çµæœã‚·ã‚§ã‚¢æ–‡ã‚’ã‚³ãƒ”ãƒ¼</button>
<p class="muted" style="margin-top:10px"><b>ã‚·ã‚§ã‚¢æ–‡ï¼š</b><br><span id="shareText">${share}</span></p>
`;
}

function copyShare(){
const el = document.getElementById("shareText");
if(!el) return;
navigator.clipboard.writeText(el.innerText).then(()=>alert("ã‚³ãƒ”ãƒ¼ã—ãŸï¼"));
}

// åˆæœŸæç”»
render();
</script>
</body>
</html>
