<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ã“ã“ã‚ã®ã©ã†ã¶ã¤ï½œãƒãƒ¼ãƒ è¨ºæ–­ï¼ˆÎ²ï¼‰</title>
<style>
:root{
--bd:#e9e9e9;
--bd2:#d9d9d9;
--bg:#ffffff;
--soft:#fafafa;
--muted:#6b6b6b;
}
body{
font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
margin: 20px;
line-height: 1.65;
background: #fff;
}
.card{
max-width: 780px;
margin: 0 auto;
padding: 18px;
border: 1px solid var(--bd);
border-radius: 16px;
background: var(--bg);
}
h1{ margin: 0 0 6px 0; font-size: 22px; }
.muted{ color: var(--muted); font-size: 14px; }
.hr{ height:1px; background: var(--bd); margin: 16px 0; }

/* å…¥åŠ›ã‚¨ãƒªã‚¢ */
.box{
border: 1px solid var(--bd);
border-radius: 14px;
padding: 12px;
background: #fff;
}

/* 1è¡Œ(1å‹•ç‰©)ã‚’ãƒ¢ãƒã‚¤ãƒ«ã§ã‚‚å´©ã‚Œãªã„gridã« */
.row{
display: grid;
grid-template-columns: 1fr 44px 36px 44px;
gap: 10px;
align-items: center;
margin-top: 10px;
}
.pill{
display: flex;
align-items: center;
gap: 10px;
border: 1px solid var(--bd);
border-radius: 999px;
padding: 10px 12px;
background: var(--soft);
min-width: 0;
}
.pill b{ white-space: nowrap; }
.pill .short{ white-space: nowrap; }
.emoji{ font-size: 18px; }

.count{
text-align: center;
font-weight: 800;
font-size: 18px;
}

button{
padding: 10px 12px;
border-radius: 12px;
border: 1px solid var(--bd2);
background: #fff;
cursor: pointer;
font-weight: 700;
}
button:hover{ background:#f5f5f5; }
button:disabled{ opacity:.45; cursor:not-allowed; }

.actions{
display:flex;
gap:10px;
flex-wrap: wrap;
margin-top: 12px;
}

/* çµæœ */
.big{
font-size: 22px;
font-weight: 900;
margin: 8px 0;
}
.kpi{
display:grid;
grid-template-columns: 1fr;
gap: 10px;
}
@media (min-width: 740px){
.kpi{ grid-template-columns: 1fr 1fr; }
}

/* ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é¸æŠ */
.leaderBox{
margin-top: 14px;
padding: 12px;
border: 1px dashed var(--bd2);
border-radius: 14px;
background: #fff;
}
.leaderGrid{
display:grid;
grid-template-columns: 1fr;
gap: 8px;
margin-top: 8px;
}
@media (min-width: 740px){
.leaderGrid{ grid-template-columns: 1fr 1fr; }
}
label.leadOpt{
display:flex;
align-items:center;
gap:10px;
border:1px solid var(--bd);
border-radius: 12px;
padding:10px 12px;
background: var(--soft);
cursor:pointer;
user-select:none;
}
input[type="radio"]{ transform: scale(1.1); }

.preline{ white-space: pre-line; }
</style>
</head>

<body>
<div class="card">
<h1>ã“ã“ã‚ã®ã©ã†ã¶ã¤ï½œãƒãƒ¼ãƒ è¨ºæ–­ ğŸ§©</h1>
<p class="muted">æœ€å¤§5äººã¾ã§ã€‚å‹•ç‰©ã‚’äººæ•°åˆ†ã ã‘æŠ¼ã—ã¦ã€Œè¨ºæ–­ã™ã‚‹ã€ã€‚</p>

<div id="app"></div>

<p class="muted" style="margin-top:16px">
â€»äººã‚’å›ºå®šã™ã‚‹è¨ºæ–­ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<b>ã€Œã“ã®ãƒãƒ¼ãƒ ã®â€œå ´â€ã®å‚¾å‘ã€</b>ã‚’ã‚„ã•ã—ãè¦‹ã¾ã™ã€‚
</p>
</div>

<script>
/** ========= è¨­å®š ========= */
const MAX_N = 5;

const ANIMALS = [
{key:"owl", emoji:"ğŸ¦‰", name:"ãƒ•ã‚¯ãƒ­ã‚¦", short:"è¦³æ¸¬"},
{key:"dog", emoji:"ğŸ¶", name:"ã„ã¬", short:"å…±é³´"},
{key:"squirrel", emoji:"ğŸ¿ï¸", name:"ãƒªã‚¹", short:"è¨­è¨ˆ"},
{key:"cat", emoji:"ğŸ±", name:"ã­ã“", short:"æµå‹•"},
{key:"rabbit", emoji:"ğŸ°", name:"ã†ã•ã", short:"èª¿å¾‹"},
];

// é€†ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆå›å¾©ã®ä¸€æ‰‹ï¼‰
const RECOVERY_MAP = {
owl: {key:"cat", text:"ğŸ¦‰ï¼ˆè¦³æ¸¬ï¼‰ãŒå¼·ã„ã¨ãã¯ã€ğŸ±ï¼ˆæµå‹•ï¼‰ã‚’å°‘ã—è¶³ã™ã¨å ´ãŒå‹•ãã‚„ã™ã„"},
squirrel: {key:"rabbit", text:"ğŸ¿ï¸ï¼ˆè¨­è¨ˆï¼‰ãŒå¼·ã„ã¨ãã¯ã€ğŸ°ï¼ˆèª¿å¾‹ï¼‰ã§åœ§ã‚’æŠœãã¨ç‡ƒãˆã«ãã„"},
dog: {key:"owl", text:"ğŸ¶ï¼ˆå…±é³´ï¼‰ãŒå¼·ã„ã¨ãã¯ã€ğŸ¦‰ï¼ˆè¦³æ¸¬ï¼‰ã§è·é›¢ã¨æ•´ç†ã‚’å…¥ã‚Œã‚‹ã¨æ±ºã¾ã‚Šã‚„ã™ã„"},
cat: {key:"squirrel", text:"ğŸ±ï¼ˆæµå‹•ï¼‰ãŒå¼·ã„ã¨ãã¯ã€ğŸ¿ï¸ï¼ˆè¨­è¨ˆï¼‰ã§å½¢ã«è½ã¨ã™ã¨å®šç€ã—ã‚„ã™ã„"},
rabbit: {key:"dog", text:"ğŸ°ï¼ˆèª¿å¾‹ï¼‰ãŒå¼·ã„ã¨ãã¯ã€ğŸ¶ï¼ˆå…±é³´ï¼‰ã§æ¸©åº¦ã‚’å°‘ã—ä¸Šã’ã‚‹ã¨åœæ»ã—ã«ãã„"},
};

// ç©´ï¼ˆè¶³ã‚Šãªã„ã¨èµ·ããŒã¡ï¼‰
const HOLE_HINT = {
owl: "ğŸ¦‰ãŒå°‘ãªã„ã¨ã€å…¨ä½“åƒãŒã¤ã‹ã¿ã«ããã¦ã€Œä½•ã‚’å„ªå…ˆã™ã‚‹ï¼Ÿã€ãŒãµã‚ã£ã¨ã—ã‚„ã™ã„ã€‚",
dog: "ğŸ¶ãŒå°‘ãªã„ã¨ã€ç©ºæ°—ãŒå°‘ã—å›ºã¾ã‚Šã‚„ã™ãã¦ã€Œè¨€ã„ã«ãã„ã“ã¨ã€ãŒå¢—ãˆãŒã¡ã€‚",
squirrel: "ğŸ¿ï¸ãŒå°‘ãªã„ã¨ã€æ±ºã¾ã£ã¦ã‚‚å½¢ã«ãªã‚‰ãšã€Œçµå±€é€²ã¾ãªã„ã€ãŒèµ·ãã‚„ã™ã„ã€‚",
cat: "ğŸ±ãŒå°‘ãªã„ã¨ã€åˆ‡ã‚Šæ›¿ãˆãŒèµ·ãã«ããã¦ã€Œæ­£ã—ã„ã‘ã©å‹•ã‹ãªã„ã€ã«ãªã‚Šã‚„ã™ã„ã€‚",
rabbit: "ğŸ°ãŒå°‘ãªã„ã¨ã€æ‘©æ“¦ãŒæŠœã‘ã«ããã¦ã€Œãªã‚“ã‹ã—ã‚“ã©ã„ã€ãŒæ®‹ã‚Šã‚„ã™ã„ã€‚",
};

// é‡å¿ƒï¼ˆé›°å›²æ°—ï¼‰
const CENTER_HINT = {
owl: "ğŸ¦‰é‡å¿ƒï¼šã‚ˆãè¦³å¯Ÿã—ã€æ·±ãè€ƒãˆã‚‹ãƒãƒ¼ãƒ ã€‚å¼·ã¿ã¯ç†è§£ã¨æ´å¯Ÿã€‚å¼±ã¿ã¯è€ƒãˆã™ãã¦æ­¢ã¾ã‚Šã‚„ã™ã„ã€‚",
dog: "ğŸ¶é‡å¿ƒï¼šé–¢ä¿‚æ€§ã¨æ¸©åº¦ãŒå¼·ã„ãƒãƒ¼ãƒ ã€‚å¼·ã¿ã¯å®‰å¿ƒã¨å”åŠ›ã€‚å¼±ã¿ã¯æ±ºæ–­ãŒå…ˆé€ã‚Šã«ãªã‚Šã‚„ã™ã„ã€‚",
squirrel: "ğŸ¿ï¸é‡å¿ƒï¼šç¾å®Ÿã«è½ã¨ã—ã¦é€²ã‚ã‚‹ãƒãƒ¼ãƒ ã€‚å¼·ã¿ã¯å®Ÿè¡Œã¨å®‰å®šã€‚å¼±ã¿ã¯è² æ‹…ãŒé›†ä¸­ã—ç‡ƒãˆã‚„ã™ã„ã€‚",
cat: "ğŸ±é‡å¿ƒï¼šå¤‰åŒ–ã¨ã‚¢ã‚¤ãƒ‡ã‚¢ãŒå‡ºã‚‹ãƒãƒ¼ãƒ ã€‚å¼·ã¿ã¯çªç ´åŠ›ã€‚å¼±ã¿ã¯å®šç€ã›ãšæ•£ã‚Šã‚„ã™ã„ã€‚",
rabbit: "ğŸ°é‡å¿ƒï¼šæ‘©æ“¦ã‚’æ¸›ã‚‰ã—æ•´ãˆã‚‹ãƒãƒ¼ãƒ ã€‚å¼·ã¿ã¯å›å¾©ã¨å„ªã—ã•ã€‚å¼±ã¿ã¯ä¸¸ãåã¾ã‚Šåœæ»ã—ã‚„ã™ã„ã€‚",
};

/** ========= çŠ¶æ…‹ ========= */
let counts = {owl:0,dog:0,squirrel:0,cat:0,rabbit:0};
// ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆé ­/ä¸Šå¸å½¹ï¼‰ã¯ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸ã¶ã€ï¼ã“ã“ãŒé‡è¦
let leaderKey = "auto"; // auto / owl / dog / squirrel / cat / rabbit

/** ========= ãƒ˜ãƒ«ãƒ‘ ========= */
const app = document.getElementById("app");

function totalN(){
return Object.values(counts).reduce((a,b)=>a+b,0);
}
function clampNonNeg(){
for(const a of ANIMALS){
if(counts[a.key] < 0) counts[a.key] = 0;
}
}
function animalByKey(key){
return ANIMALS.find(a => a.key === key);
}
function animalLabel(key){
const a = animalByKey(key);
return a ? `${a.emoji}${a.name}` : key;
}

// 1:1:1:1:1 åˆ¤å®šï¼ˆ5ç¨®ãŒã™ã¹ã¦åŒæ•°ã§å…¥ã£ã¦ã„ã‚‹ï¼‰
function isPerfectBalance(counts){
const vals = Object.values(counts);
const n = vals.reduce((a,b)=>a+b,0);
if(n === 0) return false;
const nonZero = vals.filter(v => v > 0);
if(nonZero.length !== ANIMALS.length) return false;
return nonZero.every(v => v === nonZero[0]);
}

/** ========= UI ========= */
function render(){
const n = totalN();
const full = n >= MAX_N;

const rows = ANIMALS.map(a => {
const canAdd = !full;
const canSub = counts[a.key] > 0;
return `
<div class="row">
<div class="pill">
<span class="emoji">${a.emoji}</span>
<b>${a.name}</b>
<span class="muted short">(${a.short})</span>
</div>
<button ${canSub ? "" : "disabled"} onclick="sub('${a.key}')">âˆ’</button>
<div class="count">${counts[a.key]}</div>
<button ${canAdd ? "" : "disabled"} onclick="add('${a.key}')">ï¼‹</button>
</div>
`;
}).join("");

// ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é¸æŠï¼ˆauto + 5ç¨®ï¼‰
const leaderOptions = [
{key:"auto", label:"ğŸ§­ è‡ªå‹•ï¼ˆæœªæŒ‡å®šï¼‰"},
...ANIMALS.map(a => ({key:a.key, label:`${a.emoji} ${a.name} ã‚’â€œé ­/ä¸Šå¸å½¹â€ã¨ã—ã¦æ‰±ã†`}))
].map(opt => {
const checked = (leaderKey === opt.key) ? "checked" : "";
return `
<label class="leadOpt">
<input type="radio" name="leader" value="${opt.key}" ${checked}
onchange="setLeader('${opt.key}')">
<span>${opt.label}</span>
</label>
`;
}).join("");

app.innerHTML = `
<div class="box">
<div class="muted">äººæ•°å…¥åŠ›ï¼ˆæœ€å¤§ ${MAX_N} äººï¼‰</div>
${rows}

<div class="leaderBox">
<b>ğŸ§­ ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆé ­/ä¸Šå¸å½¹ï¼‰</b>
<div class="muted" style="margin-top:6px">
ã“ã“ã¯ã€Œèª°ãŒä¸Šå¸ã‹ï¼èª°ã®åˆ¤æ–­ãŒåŸºæº–ã«ãªã‚‹ã‹ã€ã‚’æ±ºã‚ã‚‹å ´æ‰€ã€‚<br>
â€»<b>äººæ•°ã®å¤šã•ã§è‡ªå‹•æ±ºå®šã—ã¾ã›ã‚“</b>ï¼ˆã‚ãªãŸã®â‘¢ã‚’ä¿®æ­£ï¼‰ã€‚
</div>
<div class="leaderGrid">${leaderOptions}</div>
</div>

<div class="hr"></div>
<div><b>åˆè¨ˆï¼š</b>${n} / ${MAX_N} äºº</div>

<div class="actions">
<button onclick="diagnose()" ${n>0 ? "" : "disabled"}>ğŸ§  è¨ºæ–­ã™ã‚‹</button>
<button onclick="resetAll()">ğŸ” ãƒªã‚»ãƒƒãƒˆ</button>
</div>
<div class="muted" style="margin-top:10px">â€»5äººæœªæº€ã§ã‚‚è¨ºæ–­ã§ãã¾ã™ï¼ˆÎ²ï¼‰ã€‚</div>
</div>

<div id="result"></div>
`;
}

function setLeader(k){
leaderKey = k;
}

function add(k){
if(totalN() >= MAX_N) return;
counts[k] += 1;
render();
}
function sub(k){
counts[k] -= 1;
clampNonNeg();
render();
}
function resetAll(){
counts = {owl:0,dog:0,squirrel:0,cat:0,rabbit:0};
leaderKey = "auto";
// æ•°å€¤ã¯å‡ºã•ãªã„ï¼ˆã‚„ã•ã—ãï¼‰
if(b < 0.12) return {tag:"å®‰å®š", desc:"ã‹ãªã‚Šãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ã„çŠ¶æ…‹ã€‚é•·ãèµ°ã‚Šã‚„ã™ã„ã€‚"};
if(b < 0.22) return {tag:"ã‚„ã‚„åã‚Š", desc:"å½¹å‰²ã«å°‘ã—å¯„ã‚ŠãŒã‚ã‚‹ã€‚ç©´ã‚’ã¡ã‚‡ã„è¶³ã—ã™ã‚‹ã¨æ•´ã„ã‚„ã™ã„ã€‚"};
return {tag:"åã‚Šå¼·ã‚", desc:"ç‰¹å®šã®å½¹å‰²ã«é›†ä¸­ã—ã‚„ã™ã„ã€‚ç‡ƒãˆãƒ»åœæ»ã®ã‚µã‚¤ãƒ³ãŒå‡ºã‚„ã™ã„ã®ã§ã‚±ã‚¢ã™ã‚‹ã¨å®‰å¿ƒã€‚"};
}

// ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼šé ­/ä¸Šå¸å½¹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡å®šãŒæœ€å„ªå…ˆï¼‰
function detectFormation(counts){
const keys = Object.keys(counts).filter(k => counts[k] > 0);

// æœªå…¥åŠ›ã‚„0äººã®æ™‚ã¯ä¿é™º
if(keys.length === 0){
return { name:"ğŸ§­ æœªè¨­å®š", desc:"äººæ•°ãŒå…¥ã£ã¦ã„ãªã„ã®ã§ã€ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯æœªè¨­å®šã§ã™ã€‚" };
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºã—ãŸå ´åˆï¼ˆã“ã‚ŒãŒæœ¬å‘½ï¼‰
if(leaderKey !== "auto"){
const a = animalByKey(leaderKey);
if(!a) return { name:"ğŸ§­ æœªè¨­å®š", desc:"é¸æŠãŒä¸æ­£ã§ã™ï¼ˆã‚­ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼‰ã€‚" };

// â€œé ­å½¹â€ã”ã¨ã®èª¬æ˜ï¼ˆã‚„ã•ã—ã„ï¼‰
const map = {
dog: { name:`${a.emoji}ãƒ¯ãƒ³ãƒˆãƒƒãƒ—ï¼ˆå…±é³´ãŒé ­ï¼‰`, desc:"ç©ºæ°—ã¥ãã‚Šã¨å®‰å¿ƒãŒåˆ¤æ–­ã®è»¸ã€‚ã¿ã‚“ãªãŒè©±ã—ã‚„ã™ã„åé¢ã€æ±ºæ–­ã¯å°‘ã—é…ããªã‚ŠãŒã¡ã€‚" },
owl: { name:`${a.emoji}å¸ä»¤å¡”ï¼ˆè¦³æ¸¬ãŒé ­ï¼‰`, desc:"çŠ¶æ³æ•´ç†ã¨åˆ¤æ–­ãŒè»¸ã€‚é™ã‹ã«é€²ã‚€ã‘ã©ã€æ±ºã‚ã‚‹æ™‚ã¯ã‚¹ãƒ‘ãƒƒã¨æ±ºã¾ã‚‹ã‚¿ã‚¤ãƒ—ã€‚" },
squirrel: { name:`${a.emoji}è¨­è¨ˆä¸»å°ï¼ˆè¨­è¨ˆãŒé ­ï¼‰`, desc:"æ®µå–ã‚Šã¨å½¢ã¥ãã‚ŠãŒè»¸ã€‚é€²ã¿ã‚„ã™ã„ã‘ã©ã€è² æ‹…ãŒé›†ä¸­ã—ã‚„ã™ã„ã®ã§åˆ†æ‹…ãŒå¤§äº‹ã€‚" },
cat: { name:`${a.emoji}çªç ´ä¸»å°ï¼ˆæµå‹•ãŒé ­ï¼‰`, desc:"å¤‰åŒ–ã¨ã‚¢ã‚¤ãƒ‡ã‚¢ãŒè»¸ã€‚çªç ´åŠ›ã¯å¼·ã„ã‘ã©ã€ç€åœ°ã®å½¹ã‚’ä¸€äººã¤ã‘ã‚‹ã¨å®‰å®šã™ã‚‹ã€‚" },
rabbit: { name:`${a.emoji}èª¿å¾‹ä¸»å°ï¼ˆèª¿å¾‹ãŒé ­ï¼‰`, desc:"æ‘©æ“¦ã‚’æ¸›ã‚‰ã™ã“ã¨ãŒè»¸ã€‚å„ªã—ãå›ã‚‹ã‘ã©ã€ç›®çš„ã¨æœŸé™ã‚’è»½ãç½®ãã¨åœæ»ã—ã«ãã„ã€‚" },
};
return map[leaderKey] || { name:`${a.emoji}ä¸»å°`, desc:"æŒ‡å®šã•ã‚ŒãŸå½¹å‰²ãŒåˆ¤æ–­ã®è»¸ã«ãªã‚Šã¾ã™ã€‚" };
}

// autoï¼ˆæœªæŒ‡å®šï¼‰ã®å ´åˆã ã‘ã€è»½ãâ€œç›®å®‰â€ã¨ã—ã¦å‡ºã™ï¼ˆãŸã ã—è²¬ã‚ãªã„ï¼‰
const entries = Object.entries(counts);
const max = Math.max(...entries.map(([k,v]) => v));
const top = entries.filter(([k,v]) => v === max).map(([k]) => k);

if(top.length >= 2){
return { name:"ğŸ§©æ··æˆå‹ï¼ˆè‡ªå‹•ï¼‰", desc:"ãƒˆãƒƒãƒ—ãŒåŒç‚¹ã€‚é ­å½¹ãŒå›ºå®šã•ã‚Œãšã€çŠ¶æ³ã§ãƒªãƒ¼ãƒ€ãƒ¼è¦–ç‚¹ãŒå…¥ã‚Œæ›¿ã‚ã‚Šã‚„ã™ã„ã€‚" };
}
const a = animalByKey(top[0]);
return { name:`ğŸ§­è‡ªå‹•ï¼š${a.emoji}${a.name}ä¸»å°`, desc:"æœªæŒ‡å®šãªã®ã§ã€äººæ•°ã®å¤šã„å½¹å‰²ã‚’â€œç›®å®‰â€ã¨ã—ã¦è¡¨ç¤ºã—ã¦ã„ã¾ã™ï¼ˆå¿…è¦ãªã‚‰ä¸Šã§æ‰‹å‹•æŒ‡å®šã—ã¦ã­ï¼‰ã€‚" };
}

// ã‚„ã•ã—ã„æ–‡ç« ã¾ã¨ã‚ï¼ˆâ‘£å¯¾å¿œ + â‘¡ã®1:1:1:1:1æ•‘æ¸ˆï¼‰
function makeGentleText({ center, formation, hole, rec, counts }){
const perfect = isPerfectBalance(counts);

const centerA = animalLabel(center);
const holeA = animalLabel(hole);
const recA = animalLabel(rec.key);

const centerText = perfect
? `ã„ã¾ã®ãƒãƒ¼ãƒ ã¯ã€5ã¤ã®å½¹å‰²ãŒãã‚Œã„ã«æƒã£ã¦ã„ã¾ã™ã€‚
ã€Œã©ã‚ŒãŒè‰¯ã„ï¼æ‚ªã„ã€ã§ã¯ãªãã€çŠ¶æ³ã«åˆã‚ã›ã¦è‡ªç„¶ã«å½¹å‰²ãŒå›ã‚‹ã€ã¨ã¦ã‚‚å®‰å®šã—ãŸçŠ¶æ…‹ã§ã™ã€‚`
: `ã„ã¾ã®ãƒãƒ¼ãƒ ã¯ã€Œ${centerA}ã€ã®è¦ç´ ãŒå°‘ã—å¼·ã‚ã«å‡ºã¦ã„ã¾ã™ã€‚
ãã‚Œã¯æ¬ ç‚¹ã§ã¯ãªãã€ã“ã®å ´ãŒâ€œãã†ãªã‚Šã‚„ã™ã„â€ã¨ã„ã†ã ã‘ã€‚
ã†ã¾ãå™›ã¿åˆã†ã¨é€²ã¿ã‚„ã™ã„ä¸€æ–¹ã€ç„¡ç†ã‚’ã™ã‚‹ã¨ç–²ã‚ŒãŒå‡ºã‚„ã™ã„ã®ã§ã‚±ã‚¢ã™ã‚‹ã¨å®‰å¿ƒã§ã™ã€‚`;

const formationText =
`ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€Œèª°ãŒä¸Šå¸ã‹ï¼èª°ã®åˆ¤æ–­ãŒåŸºæº–ã«ãªã‚Šã‚„ã™ã„ã‹ã€ã‚’è¡¨ã—ã¾ã™ã€‚
ä»Šå›ã¯ã€Œ${formation.name}ã€ã¨ã—ã¦å‡ºã¦ã„ã¾ã™ã€‚
ï¼ˆäººæ•°ã®å¤šã•ã§æ±ºã‚ã¦ã„ãªã„ã®ã§ã€é•å’Œæ„ŸãŒã‚ã‚Œã°ä¸Šã§æ‰‹å‹•æŒ‡å®šã—ã¦OKï¼‰`;

const holeText = perfect
? `ä»Šã¯å¤§ããªã€Œç©´ã€ã¯è¦‹ãˆã«ãã„ã§ã™ã€‚
ã‚‚ã—è©°ã¾ã£ãŸã‚‰ã€å¸ä¼šäº¤ä»£ã‚„æ™‚é–“åŒºåˆ‡ã‚Šãªã©ã€è»½ã„å¾ªç’°ã‚’å…¥ã‚Œã‚‹ã ã‘ã§ååˆ†ãªã“ã¨ãŒå¤šã„ã§ã™ã€‚`
: `ä»Šã¯ã€Œ${holeA}ã€ã®å½¹å‰²ãŒå°‘ãªã‚ã§ã™ã€‚
ã“ã‚Œã¯â€œãƒ€ãƒ¡â€ã§ã¯ãªãã€ä»Šå›ã‚ã¾ã‚Šä½¿ã‚ã‚Œã¦ã„ãªã„èƒ½åŠ›ã¨ã„ã†ã ã‘ã€‚
å°‘ã—è£œã†ã¨ã€å ´ãŒãµã£ã¨æ¥½ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚`;

const recoveryText = perfect
? `ãƒãƒ©ãƒ³ã‚¹ã¯ã‹ãªã‚Šè‰¯ã„ã§ã™ã€‚å¤‰ãˆã‚‹ãªã‚‰â€œã‚„ã‚Šæ–¹â€ã‚’å°‘ã—ã ã‘ï¼ˆè©±ã™é †ç•ªã€æ™‚é–“ã€å¸ä¼šãªã©ï¼‰ã§OKã€‚`
: `è¡Œãè©°ã¾ã‚Šã‚’æ„Ÿã˜ãŸã‚‰ã€Œ${recA}ã€ã®å‹•ãã‚’ä¸€æ™‚çš„ã«è¶³ã™ã®ãŒãŠã™ã™ã‚ã§ã™ã€‚
å¤§ããå¤‰ãˆãªãã¦ã‚‚ã€ã¡ã‚‡ã£ã¨ã—ãŸå·¥å¤«ã§ååˆ†ã§ã™ã€‚`;

return { perfect, centerText, formationText, holeText, recoveryText };
}

function diagnose(){
const result = document.getElementById("result");
const n = totalN();
if(n === 0){
result.innerHTML = "";
return;
}

const R = normalizeCounts();

const center = argMax(R);
const hole = argMin(R);
const crowd = center; // æœ€å¤§æˆåˆ†ï¼éå¯†ï¼ˆç°¡æ˜“ï¼‰
const b = biasScore(R);
const bl = biasLabel(b);

const centerTextRaw = CENTER_HINT[center]; // å…ƒã®çŸ­ã„èª¬æ˜ï¼ˆæ®‹ã™ï¼‰
const holeTextRaw = HOLE_HINT[hole];
const rec = RECOVERY_MAP[crowd];

// ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆé ­/ä¸Šå¸å½¹ï¼‰
const formation = detectFormation(counts);

// â€œè¶³ã™ãªã‚‰ã“ã‚Œâ€ã®ææ¡ˆï¼ˆç©´ or é€†ãƒ™ã‚¯ãƒˆãƒ«ï¼‰
const addKey = (R[hole] === 0) ? hole : rec.key;
const addAnimal = ANIMALS.find(x=>x.key===addKey);

// 1:1:1:1:1 ã‚’å«ã‚€ã€Œã‚„ã•ã—ã„æ–‡ç« ã€
const gentle = makeGentleText({ center, formation, hole, rec, counts });

// â‘¡ï¼šå®Œç’§ãƒãƒ©ãƒ³ã‚¹ãªã‚‰Biasã‚’â€œå®‰å®šå›ºå®šâ€æ‰±ã„ã«ã™ã‚‹ï¼ˆæ‚ªè€…ã‚’ä½œã‚‰ãªã„ï¼‰
const biasTag = gentle.perfect ? "å®‰å®š" : bl.tag;
const biasDesc = gentle.perfect
? "å½¹å‰²ãƒãƒ©ãƒ³ã‚¹ãŒã¨ã¦ã‚‚è‰¯ã„çŠ¶æ…‹ã€‚ä»Šã¯ç„¡ç†ã«èª¿æ•´ã›ãšã€è‡ªç„¶ãªå›è»¢ã‚’æ´»ã‹ã™ã®ãŒè‰¯ã•ãã†ã€‚"
: bl.desc;

// ã‚·ã‚§ã‚¢æ–‡
const share = `ãƒãƒ¼ãƒ è¨ºæ–­ï¼šé‡å¿ƒã¯${animalByKey(center).emoji}${animalByKey(center).name}ï¼ç©´ã¯${animalByKey(hole).emoji}${animalByKey(hole).name}ã€‚#ã“ã“ã‚ã®ã©ã†ã¶ã¤è¨ºæ–­`;

result.innerHTML = `
<div class="hr"></div>

<div class="big">è¨ºæ–­çµæœï¼ˆãƒãƒ¼ãƒ ã®å ´ï¼‰</div>

<div class="kpi">
<div class="box">
<b>ğŸ§  é‡å¿ƒï¼ˆã„ã¾ã®é›°å›²æ°—ï¼‰</b>
<div class="muted" style="margin-top:6px">${centerTextRaw}</div>
<div class="preline" style="margin-top:10px">${gentle.centerText}</div>
</div>

<div class="box">
<b>âš–ï¸ ãƒãƒ©ãƒ³ã‚¹ï¼š${biasTag}</b>
<div style="margin-top:8px">${biasDesc}</div>
</div>

<div class="box">
<b>ğŸ§­ ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆé ­/ä¸Šå¸å½¹ï¼‰</b>
<div style="margin-top:8px"><b>${formation.name}</b><br>${formation.desc}</div>
<div class="muted preline" style="margin-top:8px">${gentle.formationText}</div>
</div>

<div class="box">
<b>ğŸ•³ å°‘ãªã‚ã®å½¹å‰²ï¼ˆç©´ï¼‰</b>
<div class="muted" style="margin-top:6px">${holeTextRaw}</div>
<div class="preline" style="margin-top:10px">${gentle.holeText}</div>
</div>

<div class="box">
<b>ğŸ”¥ ã„ã¾è² æ‹…ãŒé›†ä¸­ã—ã‚„ã™ã„å ´æ‰€</b>
<div style="margin-top:8px">
ä»Šã„ã¡ã°ã‚“å¼·ã„ã®ã¯ <b>${animalByKey(crowd).emoji}${animalByKey(crowd).name}</b>ã€‚<br>
ã“ã“ãŒé ‘å¼µã‚Šã™ãã‚‹ã¨ã€ç‡ƒãˆãŸã‚Šæ­¢ã¾ã£ãŸã‚Šã—ã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆã€‚
</div>
</div>

<div class="box">
<b>ğŸŒ¿ å›å¾©ã®ä¸€æ‰‹</b>
<div style="margin-top:8px">${rec.text}</div>
<div class="muted preline" style="margin-top:8px">${gentle.recoveryText}</div>

<div style="margin-top:10px">
<b>âœ… ã„ã¾è¶³ã™ãªã‚‰ï¼š</b> ${addAnimal.emoji}${addAnimal.name}
<div class="muted">ï¼ˆå½¹å‰²ã ã‘30åˆ†å€Ÿã‚Šã‚‹ï¼å¸ä¼šäº¤ä»£ï¼é›‘è«‡æ ã‚’å…¥ã‚Œã‚‹â€¦ãªã©ã§OKï¼‰</div>
</div>
</div>
</div>

<div class="hr"></div>

<button onclick="copyShare()">ğŸ“‹ çµæœã‚·ã‚§ã‚¢æ–‡ã‚’ã‚³ãƒ”ãƒ¼</button>
<p class="muted" style="margin-top:10px"><b>ã‚·ã‚§ã‚¢æ–‡ï¼š</b><br><span id="shareText">${share}</span></p>
`;
}

function copyShare(){
const el = document.getElementById("shareText");
if(!el) return;
navigator.clipboard.writeText(el.innerText).then(()=>alert("ã‚³ãƒ”ãƒ¼ã—ãŸï¼"));
}

// åˆæœŸæç”»
render();
</script>
</body>
</html>
